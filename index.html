<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Minha Coleção de Filmes</title>
</head>
<body>

    <div id="login-screen">
        <h2>Acesse sua coleção</h2>
        <form id="email-login-form">
            <input type="email" id="email" placeholder="E-mail" required>
            <input type="password" id="password" placeholder="Senha" required>
            <button type="submit" id="login-button">Entrar</button>
            <button type="button" id="signup-button">Criar conta</button>
        </form>
        <button id="google-login-button">Entrar com Google</button>
    </div>

    <div id="app-screen" style="display: none;">
        <p>Você está logado! Bem-vindo.</p>
        <button id="logout-button">Sair</button>
    </div>

    <script type="module">
        // Importa as funções do Firebase que vamos usar
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.0.2/firebase-app.js";
        import { 
            getAuth, 
            onAuthStateChanged, 
            GoogleAuthProvider, 
            signInWithPopup,
            signInWithEmailAndPassword,
            createUserWithEmailAndPassword,
            signOut
        } from "https://www.gstatic.com/firebasejs/11.0.2/firebase-auth.js";
        import { getFirestore } from "https://www.gstatic.com/firebasejs/11.0.2/firebase-firestore.js";

        // SEU OBJETO DE CONFIGURAÇÃO DO FIREBASE (substitua por seus dados reais)
        const firebaseConfig = {
            apiKey: "AIzaSyBu6FyItXddK1pghqaEURKaMiQTMQZlJks",
            authDomain: "colecaodefilmes-dfa7a.firebaseapp.com",
            projectId: "colecaodefilmes-dfa7a",
            storageBucket: "colecaodefilmes-dfa7a.firebasestorage.app",
            messagingSenderId: "495818238503",
            appId: "1:495818238503:web:814178c233d5fb304a7c02"
        };

        // Inicializa o Firebase
        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);

        // Obtém referências aos elementos HTML
        const loginScreen = document.getElementById('login-screen');
        const appScreen = document.getElementById('app-screen');
        const emailLoginForm = document.getElementById('email-login-form');
        const googleLoginButton = document.getElementById('google-login-button');
        const logoutButton = document.getElementById('logout-button');
        const emailInput = document.getElementById('email');
        const passwordInput = document.getElementById('password');

        // Funções para alternar as telas
        function showLoginScreen() {
            loginScreen.style.display = 'block';
            appScreen.style.display = 'none';
        }

        function showAppScreen() {
            loginScreen.style.display = 'none';
            appScreen.style.display = 'block';
        }

        // Observador de autenticação para verificar se o usuário está logado
        onAuthStateChanged(auth, (user) => {
            if (user) {
                console.log("Usuário logado:", user);
                showAppScreen();
            } else {
                console.log("Nenhum usuário logado.");
                showLoginScreen();
            }
        });

        // Lógica de Login com Email/Senha e Criação de Conta
        emailLoginForm.addEventListener('submit', async (e) => {
            e.preventDefault();
            const email = emailInput.value;
            const password = passwordInput.value;
            const submitterId = e.submitter.id;

            try {
                if (submitterId === 'login-button') {
                    await signInWithEmailAndPassword(auth, email, password);
                } else if (submitterId === 'signup-button') {
                    await createUserWithEmailAndPassword(auth, email, password);
                    alert("Conta criada com sucesso! Você pode fazer login agora.");
                }
            } catch (error) {
                console.error("Erro na autenticação:", error.message);
                alert("Erro: " + error.message);
            }
        });

        // Lógica de Login com Google
        googleLoginButton.addEventListener('click', async () => {
            const provider = new GoogleAuthProvider();
            try {
                await signInWithPopup(auth, provider);
            } catch (error) {
                console.error("Erro no login com Google:", error.message);
                alert("Erro: " + error.message);
            }
        });

        // Lógica de Logout
        logoutButton.addEventListener('click', async () => {
            try {
                await signOut(auth);
            } catch (error) {
                console.error("Erro no logout:", error.message);
            }
        });
    </script>
</body>
  </html>
